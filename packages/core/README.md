# @velund/core

Core –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Å–∏—Å—Ç–µ–º—ã UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ Velund.

–≠—Ç–æ—Ç –ø–∞–∫–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`defineVelundRenderer`, `defineVelundGenerator`, `defineComponent`), –∫–æ—Ç–æ—Ä—ã–µ —Å–ª—É–∂–∞—Ç –æ—Å–Ω–æ–≤–æ–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, —Ä–µ–Ω–¥–µ—Ä–µ—Ä–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Å Velund. –û–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —è–∑—ã–∫ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –≤–Ω—É—Ç—Ä–∏ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã Velund, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–∞–º–∏ –∏ –±—ç–∫–µ–Ω–¥-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏.

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

- **`VelundRendererDescriptor`**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ª—é–±–æ–≥–æ —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Velund (–Ω–∞–ø—Ä–∏–º–µ—Ä, Twig, Jinja, HTML).
- **`VelundGeneratorDescriptor`**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–¥—É–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –∫–æ–¥ –∏–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –±—ç–∫–µ–Ω–¥–∞, –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ Velund (–Ω–∞–ø—Ä–∏–º–µ—Ä, Python, PHP, Node.js).
- **`VelundComponentDescriptor`**: –û–ø–∏—Å—ã–≤–∞–µ—Ç UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç Velund, –≤–∫–ª—é—á–∞—è –µ–≥–æ –∏–º—è, —à–∞–±–ª–æ–Ω, —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö (`propsSchema`, `contextSchema`) –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `prepare`.
- **`defineVelundRenderer(...)`**: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞ Velund.
- **`defineVelundGenerator(...)`**: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ Velund.
- **`defineComponent(...)`**: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ Velund.

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install @velund/core
# –∏–ª–∏
yarn add @velund/core
# –∏–ª–∏
pnpm add @velund/core
```

–≠—Ç–æ—Ç –ø–∞–∫–µ—Ç –æ–±—ã—á–Ω–æ —è–≤–ª—è–µ—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é –¥–ª—è `velund` (–æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ Vite) –∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –ø–∞–∫–µ—Ç–æ–≤ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–æ–≤/–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤, –ø–æ—ç—Ç–æ–º—É –≤–∞–º, –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –µ–≥–æ –Ω–∞–ø—Ä—è–º—É—é, –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –≤—ã –Ω–µ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è Velund.

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–í—ã –±—É–¥–µ—Ç–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–µ —ç—Ç–∏–º –ø–∞–∫–µ—Ç–æ–º, –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ä–µ–Ω–¥–µ—Ä–µ—Ä–æ–≤, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏–ª–∏ —Å–∞–º–æ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ `velund`.

### `defineVelundRenderer(...)`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è defineVelundRenderer**

```typescript
// my-custom-renderer/src/index.ts
import { defineVelundRenderer, VelundComponentDescriptor } from '@velund/core';

const myCustomRenderer = defineVelundRenderer(() => {
  const components = new Map<string, VelundComponentDescriptor>();
  return {
    id: 'my-custom-templating-engine',
    templateExtensions: ['.myhmtl'], // –†–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç —Ä–µ–Ω–¥–µ—Ä–µ—Ä
    setComponents(items: VelundComponentDescriptor[]) {
      // –ú–µ—Ç–æ–¥ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —ç—Ç–æ—Ç —Ä–µ–Ω–¥–µ—Ä–µ—Ä –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å
      components.clear();
      items.forEach((comp) => components.set(comp.name, comp));
    },
    async render(name: string, context: Record<string, any>, meta?: boolean) {
      // –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
      const component = components.get(name);
      if (!component) throw new Error(`–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: ${name}`);
      let finalContext = { ...context };
      if (component.prepare) {
        finalContext = await component.prepare(context);
      }
      // –õ–æ–≥–∏–∫–∞ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ component.template —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º 'my-custom-templating-engine'
      const html = `<h1>–ü—Ä–∏–≤–µ—Ç –æ—Ç ${name}!</h1><pre>${JSON.stringify(finalContext, null, 2)}</pre>`;

      return meta ? html : { html, context }; // –î–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–±—ä–µ–∫—Ç —Å—Ç—Ä–æ–∫—É html –∏–ª–∏ –æ–±—ä–µ–∫—Ç {html, context} (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω meta)
    },
  };
});

export default myCustomRenderer;
```

–•–æ—Ä–æ—à–æ, –±–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞. –í–æ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è `defineVelundGenerator`, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ `core/README.md`:

---

### `defineVelundGenerator(...)`

`defineVelundGenerator` ‚Äî —ç—Ç–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ Velund. –û–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ (`VelundGeneratorDescriptor`). –≠—Ç–æ—Ç –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ `velund`.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞:**

- **`id: string`**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∞—à–µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'python'`, `'node'`, `'php'`). –≠—Ç–æ—Ç ID –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `velund` –≤ `vite.config.ts`.
- **`initialize?(options?: any): void`**: (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ú–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞ `velund`. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞, –∏—Å–ø–æ–ª—å–∑—É—è –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏.
- **`generate(components: VelundComponentDescriptor[], outputDir: string): Promise<void>`**: –û—Å–Ω–æ–≤–Ω–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –û–Ω –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–ª–∞–≥–∏–Ω–æ–º `velund` –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ (`vite build`).
  - `components`: –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ `VelundComponentDescriptor`, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö (–∏—Ö –∏–º–µ–Ω–∞, —Å—Å—ã–ª–∫–∏ –Ω–∞ —à–∞–±–ª–æ–Ω—ã, `propsSchema`, `contextSchema` –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –º–µ—Ç–æ–¥ `prepare`).
  - `outputDir`: –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –∫—É–¥–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–±–∏–±–ª–∏–æ—Ç–µ–∫–∏, DTO, –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã).

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `defineVelundGenerator`:**

```typescript
import { defineVelundGenerator, VelundComponentDescriptor } from '@velund/core';
import { promises as fs } from 'fs';
import { join } from 'path';

// –û–ø—Ü–∏–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
export interface MyCustomGeneratorOptions {
  namespace: string;
}

// –§–∞—Å–∞–¥–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –±—É–¥—É—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ vite.config.ts
export default function myCustomGenerator(options?: MyCustomGeneratorOptions) {
  // defineVelundGenerator –æ–∂–∏–¥–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –≤–æ–∑–≤—Ä–∞—â–∞—é—â—É—é –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä
  return defineVelundGenerator(() => {
    let settings = { namespace: 'Default' }; // –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞

    return {
      id: 'my-custom-lang', // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞

      // –ú–µ—Ç–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
      initialize(opts?: MyCustomGeneratorOptions) {
        if (opts) {
          settings = { ...settings, ...opts };
        }
        console.log(
          `[MyCustomGenerator] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏: ${settings.namespace}`
        );
      },

      // –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞
      async generate(
        components: VelundComponentDescriptor[],
        outputDir: string
      ) {
        const langSpecificDir = join(
          outputDir,
          settings.namespace.toLowerCase()
        );
        await fs.mkdir(langSpecificDir, { recursive: true });

        const generatedFiles: string[] = [];
        for (const component of components) {
          // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è VelundComponentDescriptor
          // –≤ –∫–æ–¥ —Ü–µ–ª–µ–≤–æ–≥–æ —è–∑—ã–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Python, PHP, JS, C#)
          // –í–∫–ª—é—á–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—é DTO –Ω–∞ –æ—Å–Ω–æ–≤–µ propsSchema/contextSchema
          // –∏ –∫–æ–¥ –¥–ª—è Render-–∫–ª–∞—Å—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å prepare-–º–µ—Ç–æ–¥—ã.

          const content =
            `// –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –¥–ª—è ${component.name} –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –∏–º–µ–Ω ${settings.namespace}\n` +
            `// props: ${JSON.stringify(component.propsSchema)}\n` +
            `// context: ${JSON.stringify(component.contextSchema)}`;
          const filePath = join(
            langSpecificDir,
            `${component.name}.custom_lang`
          );
          await fs.writeFile(filePath, content);
          generatedFiles.push(filePath);
        }
        console.log(
          `[MyCustomGenerator] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ñ–∞–π–ª—ã: ${generatedFiles.join(', ')}`
        );
      },
    };
  });
}
```
